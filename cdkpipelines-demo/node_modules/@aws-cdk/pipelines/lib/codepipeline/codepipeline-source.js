"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodePipelineSource = void 0;
const jsiiDeprecationWarnings = require("../../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const cp_actions = require("@aws-cdk/aws-codepipeline-actions");
const core_1 = require("@aws-cdk/core");
const constructs_1 = require("constructs");
const blueprint_1 = require("../blueprint");
const outputs_1 = require("./private/outputs");
/**
 * Factory for CodePipeline source steps
 *
 * This class contains a number of factory methods for the different types
 * of sources that CodePipeline supports.
 */
class CodePipelineSource extends blueprint_1.Step {
    constructor() {
        super(...arguments);
        // tells `PipelineGraph` to hoist a "Source" step
        this.isSource = true;
    }
    /**
     * Returns a GitHub source, using OAuth tokens to authenticate with
     * GitHub and a separate webhook to detect changes. This is no longer
     * the recommended method. Please consider using `connection()`
     * instead.
     *
     * Pass in the owner and repository in a single string, like this:
     *
     * ```ts
     * pipelines.CodePipelineSource.gitHub('owner/repo', 'main');
     * ```
     *
     * Authentication will be done by a secret called `github-token` in AWS
     * Secrets Manager (unless specified otherwise).
     *
     * The token should have these permissions:
     *
     * * **repo** - to read the repository
     * * **admin:repo_hook** - if you plan to use webhooks (true by default)
     */
    static gitHub(repoString, branch, props = {}) {
        jsiiDeprecationWarnings._aws_cdk_pipelines_GitHubSourceOptions(props);
        return new GitHubSource(repoString, branch, props);
    }
    /**
     * Returns an S3 source.
     *
     * @param bucket The bucket where the source code is located.
     * @param props The options, which include the key that identifies the source code file and
     * and how the pipeline should be triggered.
     *
     * @example
     * declare const bucket: s3.Bucket;
     * pipelines.CodePipelineSource.s3(bucket, 'path/to/file.zip');
     */
    static s3(bucket, objectKey, props = {}) {
        jsiiDeprecationWarnings._aws_cdk_pipelines_S3SourceOptions(props);
        return new S3Source(bucket, objectKey, props);
    }
    /**
     * Returns an ECR source.
     *
     * @param repository The repository that will be watched for changes.
     * @param props The options, which include the image tag to be checked for changes.
     *
     * @example
     * declare const repository: ecr.IRepository;
     * pipelines.CodePipelineSource.ecr(repository, {
     *   imageTag: 'latest',
     * });
     */
    static ecr(repository, props = {}) {
        jsiiDeprecationWarnings._aws_cdk_pipelines_ECRSourceOptions(props);
        return new ECRSource(repository, props);
    }
    /**
     * Returns a CodeStar connection source. A CodeStar connection allows AWS CodePipeline to
     * access external resources, such as repositories in GitHub, GitHub Enterprise or
     * BitBucket.
     *
     * To use this method, you first need to create a CodeStar connection
     * using the AWS console. In the process, you may have to sign in to the external provider
     * -- GitHub, for example -- to authorize AWS to read and modify your repository.
     * Once you have done this, copy the connection ARN and use it to create the source.
     *
     * Example:
     *
     * ```ts
     * pipelines.CodePipelineSource.connection('owner/repo', 'main', {
     *   connectionArn: 'arn:aws:codestar-connections:us-east-1:222222222222:connection/7d2469ff-514a-4e4f-9003-5ca4a43cdc41', // Created using the AWS console
     * });
     * ```
     *
     * @param repoString A string that encodes owner and repository separated by a slash (e.g. 'owner/repo').
     * @param branch The branch to use.
     * @param props The source properties, including the connection ARN.
     *
     * @see https://docs.aws.amazon.com/dtconsole/latest/userguide/welcome-connections.html
     */
    static connection(repoString, branch, props) {
        jsiiDeprecationWarnings._aws_cdk_pipelines_ConnectionSourceOptions(props);
        return new CodeStarConnectionSource(repoString, branch, props);
    }
    /**
     * Returns a CodeCommit source.
     *
     * @param repository The CodeCommit repository.
     * @param branch The branch to use.
     * @param props The source properties.
     *
     * @example
     * declare const repository: codecommit.IRepository;
     * pipelines.CodePipelineSource.codeCommit(repository, 'main');
     */
    static codeCommit(repository, branch, props = {}) {
        jsiiDeprecationWarnings._aws_cdk_pipelines_CodeCommitSourceOptions(props);
        return new CodeCommitSource(repository, branch, props);
    }
    produceAction(stage, options) {
        jsiiDeprecationWarnings._aws_cdk_pipelines_ProduceActionOptions(options);
        const output = options.artifacts.toCodePipeline(this.primaryOutput);
        const action = this.getAction(output, options.actionName, options.runOrder, options.variablesNamespace);
        stage.addAction(action);
        return { runOrdersConsumed: 1 };
    }
    /**
     * Return an attribute of the current source revision
     *
     * These values can be passed into the environment variables of pipeline steps,
     * so your steps can access information about the source revision.
     *
     * What attributes are available depends on the type of source. These attributes
     * are supported:
     *
     * - GitHub, CodeCommit, and CodeStarSourceConnection
     *   - `AuthorDate`
     *   - `BranchName`
     *   - `CommitId`
     *   - `CommitMessage`
     * - GitHub, CodeCommit and ECR
     *   - `RepositoryName`
     * - GitHub and CodeCommit
     *   - `CommitterDate`
     * - GitHub
     *   - `CommitUrl`
     * - CodeStarSourceConnection
     *   - `FullRepositoryName`
     * - S3
     *   - `ETag`
     *   - `VersionId`
     * - ECR
     *   - `ImageDigest`
     *   - `ImageTag`
     *   - `ImageURI`
     *   - `RegistryId`
     *
     * @see https://docs.aws.amazon.com/codepipeline/latest/userguide/reference-variables.html#reference-variables-list
     */
    sourceAttribute(name) {
        return outputs_1.makeCodePipelineOutput(this, name);
    }
}
exports.CodePipelineSource = CodePipelineSource;
_a = JSII_RTTI_SYMBOL_1;
CodePipelineSource[_a] = { fqn: "@aws-cdk/pipelines.CodePipelineSource", version: "1.148.0" };
/**
 * Extend CodePipelineSource so we can type-test in the CodePipelineEngine.
 */
class GitHubSource extends CodePipelineSource {
    constructor(repoString, branch, props) {
        var _b;
        super(repoString);
        this.branch = branch;
        this.props = props;
        const parts = repoString.split('/');
        if (core_1.Token.isUnresolved(repoString) || parts.length !== 2) {
            throw new Error(`GitHub repository name should be a resolved string like '<owner>/<repo>', got '${repoString}'`);
        }
        this.owner = parts[0];
        this.repo = parts[1];
        this.authentication = (_b = props.authentication) !== null && _b !== void 0 ? _b : core_1.SecretValue.secretsManager('github-token');
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, actionName, runOrder, variablesNamespace) {
        return new cp_actions.GitHubSourceAction({
            output,
            actionName,
            runOrder,
            oauthToken: this.authentication,
            owner: this.owner,
            repo: this.repo,
            branch: this.branch,
            trigger: this.props.trigger,
            variablesNamespace,
        });
    }
}
class S3Source extends CodePipelineSource {
    constructor(bucket, objectKey, props) {
        super(constructs_1.Node.of(bucket).addr);
        this.bucket = bucket;
        this.objectKey = objectKey;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        var _b;
        return new cp_actions.S3SourceAction({
            output,
            // Bucket names are guaranteed to conform to ActionName restrictions
            actionName: (_b = this.props.actionName) !== null && _b !== void 0 ? _b : this.bucket.bucketName,
            runOrder,
            bucketKey: this.objectKey,
            trigger: this.props.trigger,
            bucket: this.bucket,
            variablesNamespace,
        });
    }
}
class ECRSource extends CodePipelineSource {
    constructor(repository, props) {
        super(constructs_1.Node.of(repository).addr);
        this.repository = repository;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        var _b;
        // RepositoryName can contain '/' that is not a valid ActionName character, use '_' instead
        const formattedRepositoryName = core_1.Fn.join('_', core_1.Fn.split('/', this.repository.repositoryName));
        return new cp_actions.EcrSourceAction({
            output,
            actionName: (_b = this.props.actionName) !== null && _b !== void 0 ? _b : formattedRepositoryName,
            runOrder,
            repository: this.repository,
            imageTag: this.props.imageTag,
            variablesNamespace,
        });
    }
}
class CodeStarConnectionSource extends CodePipelineSource {
    constructor(repoString, branch, props) {
        super(repoString);
        this.branch = branch;
        this.props = props;
        const parts = repoString.split('/');
        if (core_1.Token.isUnresolved(repoString) || parts.length !== 2) {
            throw new Error(`CodeStar repository name should be a resolved string like '<owner>/<repo>', got '${repoString}'`);
        }
        this.owner = parts[0];
        this.repo = parts[1];
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, actionName, runOrder, variablesNamespace) {
        return new cp_actions.CodeStarConnectionsSourceAction({
            output,
            actionName,
            runOrder,
            connectionArn: this.props.connectionArn,
            owner: this.owner,
            repo: this.repo,
            branch: this.branch,
            codeBuildCloneOutput: this.props.codeBuildCloneOutput,
            triggerOnPush: this.props.triggerOnPush,
            variablesNamespace,
        });
    }
}
class CodeCommitSource extends CodePipelineSource {
    constructor(repository, branch, props) {
        super(core_1.Token.isUnresolved(repository.repositoryName)
            ? constructs_1.Node.of(repository).addr
            : repository.repositoryName);
        this.repository = repository;
        this.branch = branch;
        this.props = props;
        this.configurePrimaryOutput(new blueprint_1.FileSet('Source', this));
    }
    getAction(output, _actionName, runOrder, variablesNamespace) {
        return new cp_actions.CodeCommitSourceAction({
            output,
            // Guaranteed to be okay as action name
            actionName: this.repository.repositoryName,
            runOrder,
            branch: this.branch,
            trigger: this.props.trigger,
            repository: this.repository,
            eventRole: this.props.eventRole,
            codeBuildCloneOutput: this.props.codeBuildCloneOutput,
            variablesNamespace,
        });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29kZXBpcGVsaW5lLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNvZGVwaXBlbGluZS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBR0EsZ0VBQWdFO0FBS2hFLHdDQUF1RDtBQUN2RCwyQ0FBa0M7QUFDbEMsNENBQTZDO0FBRTdDLCtDQUEyRDtBQUUzRDs7Ozs7R0FLRztBQUNILE1BQXNCLGtCQUFtQixTQUFRLGdCQUFJO0lBQXJEOztRQW1HRSxpREFBaUQ7UUFDakMsYUFBUSxHQUFHLElBQUksQ0FBQztLQWdEakM7SUFuSkM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0FtQkc7SUFDSSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQWtCLEVBQUUsTUFBYyxFQUFFLFFBQTZCLEVBQUU7O1FBQ3RGLE9BQU8sSUFBSSxZQUFZLENBQUMsVUFBVSxFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsQ0FBQztLQUNwRDtJQUVEOzs7Ozs7Ozs7O09BVUc7SUFDSSxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQWUsRUFBRSxTQUFpQixFQUFFLFFBQXlCLEVBQUU7O1FBQzlFLE9BQU8sSUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztLQUMvQztJQUVEOzs7Ozs7Ozs7OztPQVdHO0lBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUF1QixFQUFFLFFBQTBCLEVBQUU7O1FBQ3JFLE9BQU8sSUFBSSxTQUFTLENBQUMsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0tBQ3pDO0lBRUQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O09BdUJHO0lBQ0ksTUFBTSxDQUFDLFVBQVUsQ0FBQyxVQUFrQixFQUFFLE1BQWMsRUFBRSxLQUE4Qjs7UUFDekYsT0FBTyxJQUFJLHdCQUF3QixDQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDaEU7SUFFRDs7Ozs7Ozs7OztPQVVHO0lBQ0ksTUFBTSxDQUFD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bnQiOlsiaW1wb3J0ICogYXMgY29kZWNvbW1pdCBmcm9tICdAYXdzLWNkay9hd3MtY29kZWNvbW1pdCc7XG5pbXBvcnQgKiBhcyBjcCBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lJztcbmltcG9ydCB7IEFydGlmYWN0IH0gZnJvbSAnQGF3cy1jZGsvYXdzLWNvZGVwaXBlbGluZSc7XG5pbXBvcnQgKiBhcyBjcF9hY3Rpb25zIGZyb20gJ0Bhd3MtY2RrL2F3cy1jb2RlcGlwZWxpbmUtYWN0aW9ucyc7XG5pbXBvcnQgeyBBY3Rpb24sIENvZGVDb21taXRUcmlnZ2VyLCBHaXRIdWJUcmlnZ2VyLCBTM1RyaWdnZXIgfSBmcm9tICdAYXdzLWNkay9hd3MtY29kZXBpcGVsaW5lLWFjdGlvbnMnO1xuaW1wb3J0IHsgSVJlcG9zaXRvcnkgfSBmcm9tICdAYXdzLWNkay9hd3MtZWNyJztcbmltcG9ydCAqIGFzIGlhbSBmcm9tICdAYXdzLWNkay9hd3MtaWFtJztcbmltcG9ydCB7IElCdWNrZXQgfSBmcm9tICdAYXdzLWNkay9hd3MtczMnO1xuaW1wb3J0IHsgRm4sIFNlY3JldFZhbHVlLCBUb2tlbiB9IGZyb20gJ0Bhd3MtY2RrL2NvcmUnO1xuaW1wb3J0IHsgTm9kZSB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgRmlsZVNldCwgU3RlcCB9IGZyb20gJy4uL2JsdWVwcmludCc7XG5pbXBvcnQgeyBDb2RlUGlwZWxpbmVBY3Rpb25GYWN0b3J5UmVzdWx0LCBQcm9kdWNlQWN0aW9uT3B0aW9ucywgSUNvZGVQaXBlbGluZUFjdGlvbkZhY3RvcnkgfSBmcm9tICcuL2NvZGVwaXBlbGluZS1hY3Rpb24tZmFjdG9yeSc7XG5pbXBvcnQgeyBtYWtlQ29kZVBpcGVsaW5lT3V0cHV0IH0gZnJvbSAnLi9wcml2YXRlL291dHB1dHMnO1xuXG4vKipcbiAqIEZhY3RvcnkgZm9yIENvZGVQaXBlbGluZSBzb3VyY2Ugc3RlcHNcbiAqXG4gKiBUaGlzIGNsYXNzIGNvbnRhaW5zIGEgbnVtYmVyIG9mIGZhY3RvcnkgbWV0aG9kcyBmb3IgdGhlIGRpZmZlcmVudCB0eXBlc1xuICogb2Ygc291cmNlcyB0aGF0IENvZGVQaXBlbGluZSBzdXBwb3J0cy5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENvZGVQaXBlbGluZVNvdXJjZSBleHRlbmRzIFN0ZXAgaW1wbGVtZW50cyBJQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeSB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgR2l0SHViIHNvdXJjZSwgdXNpbmcgT0F1dGggdG9rZW5zIHRvIGF1dGhlbnRpY2F0ZSB3aXRoXG4gICAqIEdpdEh1YiBhbmQgYSBzZXBhcmF0ZSB3ZWJob29rIHRvIGRldGVjdCBjaGFuZ2VzLiBUaGlzIGlzIG5vIGxvbmdlclxuICAgKiB0aGUgcmVjb21tZW5kZWQgbWV0aG9kLiBQbGVhc2UgY29uc2lkZXIgdXNpbmcgYGNvbm5lY3Rpb24oKWBcbiAgICogaW5zdGVhZC5cbiAgICpcbiAgICogUGFzcyBpbiB0aGUgb3duZXIgYW5kIHJlcG9zaXRvcnkgaW4gYSBzaW5nbGUgc3RyaW5nLCBsaWtlIHRoaXM6XG4gICAqXG4gICAqIGBgYHRzXG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuZ2l0SHViKCdvd25lci9yZXBvJywgJ21haW4nKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEF1dGhlbnRpY2F0aW9uIHdpbGwgYmUgZG9uZSBieSBhIHNlY3JldCBjYWxsZWQgYGdpdGh1Yi10b2tlbmAgaW4gQVdTXG4gICAqIFNlY3JldHMgTWFuYWdlciAodW5sZXNzIHNwZWNpZmllZCBvdGhlcndpc2UpLlxuICAgKlxuICAgKiBUaGUgdG9rZW4gc2hvdWxkIGhhdmUgdGhlc2UgcGVybWlzc2lvbnM6XG4gICAqXG4gICAqICogKipyZXBvKiogLSB0byByZWFkIHRoZSByZXBvc2l0b3J5XG4gICAqICogKiphZG1pbjpyZXBvX2hvb2sqKiAtIGlmIHlvdSBwbGFuIHRvIHVzZSB3ZWJob29rcyAodHJ1ZSBieSBkZWZhdWx0KVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBnaXRIdWIocmVwb1N0cmluZzogc3RyaW5nLCBicmFuY2g6IHN0cmluZywgcHJvcHM6IEdpdEh1YlNvdXJjZU9wdGlvbnMgPSB7fSk6IENvZGVQaXBlbGluZVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBHaXRIdWJTb3VyY2UocmVwb1N0cmluZywgYnJhbmNoLCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBTMyBzb3VyY2UuXG4gICAqXG4gICAqIEBwYXJhbSBidWNrZXQgVGhlIGJ1Y2tldCB3aGVyZSB0aGUgc291cmNlIGNvZGUgaXMgbG9jYXRlZC5cbiAgICogQHBhcmFtIHByb3BzIFRoZSBvcHRpb25zLCB3aGljaCBpbmNsdWRlIHRoZSBrZXkgdGhhdCBpZGVudGlmaWVzIHRoZSBzb3VyY2UgY29kZSBmaWxlIGFuZFxuICAgKiBhbmQgaG93IHRoZSBwaXBlbGluZSBzaG91bGQgYmUgdHJpZ2dlcmVkLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBkZWNsYXJlIGNvbnN0IGJ1Y2tldDogczMuQnVja2V0O1xuICAgKiBwaXBlbGluZXMuQ29kZVBpcGVsaW5lU291cmNlLnMzKGJ1Y2tldCwgJ3BhdGgvdG8vZmlsZS56aXAnKTtcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgczMoYnVja2V0OiBJQnVja2V0LCBvYmplY3RLZXk6IHN0cmluZywgcHJvcHM6IFMzU291cmNlT3B0aW9ucyA9IHt9KTogQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgICByZXR1cm4gbmV3IFMzU291cmNlKGJ1Y2tldCwgb2JqZWN0S2V5LCBwcm9wcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBFQ1Igc291cmNlLlxuICAgKlxuICAgKiBAcGFyYW0gcmVwb3NpdG9yeSBUaGUgcmVwb3NpdG9yeSB0aGF0IHdpbGwgYmUgd2F0Y2hlZCBmb3IgY2hhbmdlcy5cbiAgICogQHBhcmFtIHByb3BzIFRoZSBvcHRpb25zLCB3aGljaCBpbmNsdWRlIHRoZSBpbWFnZSB0YWcgdG8gYmUgY2hlY2tlZCBmb3IgY2hhbmdlcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogZGVjbGFyZSBjb25zdCByZXBvc2l0b3J5OiBlY3IuSVJlcG9zaXRvcnk7XG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuZWNyKHJlcG9zaXRvcnksIHtcbiAgICogICBpbWFnZVRhZzogJ2xhdGVzdCcsXG4gICAqIH0pO1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBlY3IocmVwb3NpdG9yeTogSVJlcG9zaXRvcnksIHByb3BzOiBFQ1JTb3VyY2VPcHRpb25zID0ge30pOiBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgRUNSU291cmNlKHJlcG9zaXRvcnksIHByb3BzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgQ29kZVN0YXIgY29ubmVjdGlvbiBzb3VyY2UuIEEgQ29kZVN0YXIgY29ubmVjdGlvbiBhbGxvd3MgQVdTIENvZGVQaXBlbGluZSB0b1xuICAgKiBhY2Nlc3MgZXh0ZXJuYWwgcmVzb3VyY2VzLCBzdWNoIGFzIHJlcG9zaXRvcmllcyBpbiBHaXRIdWIsIEdpdEh1YiBFbnRlcnByaXNlIG9yXG4gICAqIEJpdEJ1Y2tldC5cbiAgICpcbiAgICogVG8gdXNlIHRoaXMgbWV0aG9kLCB5b3UgZmlyc3QgbmVlZCB0byBjcmVhdGUgYSBDb2RlU3RhciBjb25uZWN0aW9uXG4gICAqIHVzaW5nIHRoZSBBV1MgY29uc29sZS4gSW4gdGhlIHByb2Nlc3MsIHlvdSBtYXkgaGF2ZSB0byBzaWduIGluIHRvIHRoZSBleHRlcm5hbCBwcm92aWRlclxuICAgKiAtLSBHaXRIdWIsIGZvciBleGFtcGxlIC0tIHRvIGF1dGhvcml6ZSBBV1MgdG8gcmVhZCBhbmQgbW9kaWZ5IHlvdXIgcmVwb3NpdG9yeS5cbiAgICogT25jZSB5b3UgaGF2ZSBkb25lIHRoaXMsIGNvcHkgdGhlIGNvbm5lY3Rpb24gQVJOIGFuZCB1c2UgaXQgdG8gY3JlYXRlIHRoZSBzb3VyY2UuXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqXG4gICAqIGBgYHRzXG4gICAqIHBpcGVsaW5lcy5Db2RlUGlwZWxpbmVTb3VyY2UuY29ubmVjdGlvbignb3duZXIvcmVwbycsICdtYWluJywge1xuICAgKiAgIGNvbm5lY3Rpb25Bcm46ICdhcm46YXdzOmNvZGVzdGFyLWNvbm5lY3Rpb25zOnVzLWVhc3QtMToyMjIyMjIyMjIyMjI6Y29ubmVjdGlvbi83ZDI0NjlmZi01MTRhLTRlNGYtOTAwMy01Y2E0YTQzY2RjNDEnLCAvLyBDcmVhdGVkIHVzaW5nIHRoZSBBV1MgY29uc29sZVxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBwYXJhbSByZXBvU3RyaW5nIEEgc3RyaW5nIHRoYXQgZW5jb2RlcyBvd25lciBhbmQgcmVwb3NpdG9yeSBzZXBhcmF0ZWQgYnkgYSBzbGFzaCAoZS5nLiAnb3duZXIvcmVwbycpLlxuICAgKiBAcGFyYW0gYnJhbmNoIFRoZSBicmFuY2ggdG8gdXNlLlxuICAgKiBAcGFyYW0gcHJvcHMgVGhlIHNvdXJjZSBwcm9wZXJ0aWVzLCBpbmNsdWRpbmcgdGhlIGNvbm5lY3Rpb24gQVJOLlxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9kdGNvbnNvbGUvbGF0ZXN0L3VzZXJndWlkZS93ZWxjb21lLWNvbm5lY3Rpb25zLmh0bWxcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgY29ubmVjdGlvbihyZXBvU3RyaW5nOiBzdHJpbmcsIGJyYW5jaDogc3RyaW5nLCBwcm9wczogQ29ubmVjdGlvblNvdXJjZU9wdGlvbnMpOiBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgQ29kZVN0YXJDb25uZWN0aW9uU291cmNlKHJlcG9TdHJpbmcsIGJyYW5jaCwgcHJvcHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBDb2RlQ29tbWl0IHNvdXJjZS5cbiAgICpcbiAgICogQHBhcmFtIHJlcG9zaXRvcnkgVGhlIENvZGVDb21taXQgcmVwb3NpdG9yeS5cbiAgICogQHBhcmFtIGJyYW5jaCBUaGUgYnJhbmNoIHRvIHVzZS5cbiAgICogQHBhcmFtIHByb3BzIFRoZSBzb3VyY2UgcHJvcGVydGllcy5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogZGVjbGFyZSBjb25zdCByZXBvc2l0b3J5OiBjb2RlY29tbWl0LklSZXBvc2l0b3J5O1xuICAgKiBwaXBlbGluZXMuQ29kZVBpcGVsaW5lU291cmNlLmNvZGVDb21taXQocmVwb3NpdG9yeSwgJ21haW4nKTtcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgY29kZUNvbW1pdChyZXBvc2l0b3J5OiBjb2RlY29tbWl0LklSZXBvc2l0b3J5LCBicmFuY2g6IHN0cmluZywgcHJvcHM6IENvZGVDb21taXRTb3VyY2VPcHRpb25zID0ge30pOiBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICAgIHJldHVybiBuZXcgQ29kZUNvbW1pdFNvdXJjZShyZXBvc2l0b3J5LCBicmFuY2gsIHByb3BzKTtcbiAgfVxuXG4gIC8vIHRlbGxzIGBQaXBlbGluZUdyYXBoYCB0byBob2lzdCBhIFwiU291cmNlXCIgc3RlcFxuICBwdWJsaWMgcmVhZG9ubHkgaXNTb3VyY2UgPSB0cnVlO1xuXG4gIHB1YmxpYyBwcm9kdWNlQWN0aW9uKHN0YWdlOiBjcC5JU3RhZ2UsIG9wdGlvbnM6IFByb2R1Y2VBY3Rpb25PcHRpb25zKTogQ29kZVBpcGVsaW5lQWN0aW9uRmFjdG9yeVJlc3VsdCB7XG4gICAgY29uc3Qgb3V0cHV0ID0gb3B0aW9ucy5hcnRpZmFjdHMudG9Db2RlUGlwZWxpbmUodGhpcy5wcmltYXJ5T3V0cHV0ISk7XG5cbiAgICBjb25zdCBhY3Rpb24gPSB0aGlzLmdldEFjdGlvbihvdXRwdXQsIG9wdGlvbnMuYWN0aW9uTmFtZSwgb3B0aW9ucy5ydW5PcmRlciwgb3B0aW9ucy52YXJpYWJsZXNOYW1lc3BhY2UpO1xuICAgIHN0YWdlLmFkZEFjdGlvbihhY3Rpb24pO1xuICAgIHJldHVybiB7IHJ1bk9yZGVyc0NvbnN1bWVkOiAxIH07XG4gIH1cblxuICBwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0QWN0aW9uKG91dHB1dDogQXJ0aWZhY3QsIGFjdGlvbk5hbWU6IHN0cmluZywgcnVuT3JkZXI6IG51bWJlciwgdmFyaWFibGVzTmFtZXNwYWNlPzogc3RyaW5nKTogQWN0aW9uO1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gYW4gYXR0cmlidXRlIG9mIHRoZSBjdXJyZW50IHNvdXJjZSByZXZpc2lvblxuICAgKlxuICAgKiBUaGVzZSB2YWx1ZXMgY2FuIGJlIHBhc3NlZCBpbnRvIHRoZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgb2YgcGlwZWxpbmUgc3RlcHMsXG4gICAqIHNvIHlvdXIgc3RlcHMgY2FuIGFjY2VzcyBpbmZvcm1hdGlvbiBhYm91dCB0aGUgc291cmNlIHJldmlzaW9uLlxuICAgKlxuICAgKiBXaGF0IGF0dHJpYnV0ZXMgYXJlIGF2YWlsYWJsZSBkZXBlbmRzIG9uIHRoZSB0eXBlIG9mIHNvdXJjZS4gVGhlc2UgYXR0cmlidXRlc1xuICAgKiBhcmUgc3VwcG9ydGVkOlxuICAgKlxuICAgKiAtIEdpdEh1YiwgQ29kZUNvbW1pdCwgYW5kIENvZGVTdGFyU291cmNlQ29ubmVjdGlvblxuICAgKiAgIC0gYEF1dGhvckRhdGVgXG4gICAqICAgLSBgQnJhbmNoTmFtZWBcbiAgICogICAtIGBDb21taXRJZGBcbiAgICogICAtIGBDb21taXRNZXNzYWdlYFxuICAgKiAtIEdpdEh1YiwgQ29kZUNvbW1pdCBhbmQgRUNSXG4gICAqICAgLSBgUmVwb3NpdG9yeU5hbWVgXG4gICAqIC0gR2l0SHViIGFuZCBDb2RlQ29tbWl0XG4gICAqICAgLSBgQ29tbWl0dGVyRGF0ZWBcbiAgICogLSBHaXRIdWJcbiAgICogICAtIGBDb21taXRVcmxgXG4gICAqIC0gQ29kZVN0YXJTb3VyY2VDb25uZWN0aW9uXG4gICAqICAgLSBgRnVsbFJlcG9zaXRvcnlOYW1lYFxuICAgKiAtIFMzXG4gICAqICAgLSBgRVRhZ2BcbiAgICogICAtIGBWZXJzaW9uSWRgXG4gICAqIC0gRUNSXG4gICAqICAgLSBgSW1hZ2VEaWdlc3RgXG4gICAqICAgLSBgSW1hZ2VUYWdgXG4gICAqICAgLSBgSW1hZ2VVUklgXG4gICAqICAgLSBgUmVnaXN0cnlJZGBcbiAgICpcbiAgICogQHNlZSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vY29kZXBpcGVsaW5lL2xhdGVzdC91c2VyZ3VpZGUvcmVmZXJlbmNlLXZhcmlhYmxlcy5odG1sI3JlZmVyZW5jZS12YXJpYWJsZXMtbGlzdFxuICAgKi9cbiAgcHVibGljIHNvdXJjZUF0dHJpYnV0ZShuYW1lOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBtYWtlQ29kZVBpcGVsaW5lT3V0cHV0KHRoaXMsIG5hbWUpO1xuICB9XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgR2l0SHViIHNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHaXRIdWJTb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIEEgR2l0SHViIE9BdXRoIHRva2VuIHRvIHVzZSBmb3IgYXV0aGVudGljYXRpb24uXG4gICAqXG4gICAqIEl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSBhIFNlY3JldHMgTWFuYWdlciBgU2VjcmV0YCB0byBvYnRhaW4gdGhlIHRva2VuOlxuICAgKlxuICAgKiBgYGB0c1xuICAgKiBjb25zdCBvYXV0aCA9IGNkay5TZWNyZXRWYWx1ZS5zZWNyZXRzTWFuYWdlcignbXktZ2l0aHViLXRva2VuJyk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBUaGUgR2l0SHViIFBlcnNvbmFsIEFjY2VzcyBUb2tlbiBzaG91bGQgaGF2ZSB0aGVzZSBzY29wZXM6XG4gICAqXG4gICAqICogKipyZXBvKiogLSB0byByZWFkIHRoZSByZXBvc2l0b3J5XG4gICAqICogKiphZG1pbjpyZXBvX2hvb2sqKiAtIGlmIHlvdSBwbGFuIHRvIHVzZSB3ZWJob29rcyAodHJ1ZSBieSBkZWZhdWx0KVxuICAgKlxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9HaXRIdWItY3JlYXRlLXBlcnNvbmFsLXRva2VuLUNMSS5odG1sXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2VjcmV0VmFsdWUuc2VjcmV0c01hbmFnZXIoJ2dpdGh1Yi10b2tlbicpXG4gICAqL1xuICByZWFkb25seSBhdXRoZW50aWNhdGlvbj86IFNlY3JldFZhbHVlO1xuXG4gIC8qKlxuICAgKiBIb3cgQVdTIENvZGVQaXBlbGluZSBzaG91bGQgYmUgdHJpZ2dlcmVkXG4gICAqXG4gICAqIFdpdGggdGhlIGRlZmF1bHQgdmFsdWUgXCJXRUJIT09LXCIsIGEgd2ViaG9vayBpcyBjcmVhdGVkIGluIEdpdEh1YiB0aGF0IHRyaWdnZXJzIHRoZSBhY3Rpb24uXG4gICAqIFdpdGggXCJQT0xMXCIsIENvZGVQaXBlbGluZSBwZXJpb2RpY2FsbHkgY2hlY2tzIHRoZSBzb3VyY2UgZm9yIGNoYW5nZXMuXG4gICAqIFdpdGggXCJOb25lXCIsIHRoZSBhY3Rpb24gaXMgbm90IHRyaWdnZXJlZCB0aHJvdWdoIGNoYW5nZXMgaW4gdGhlIHNvdXJjZS5cbiAgICpcbiAgICogVG8gdXNlIGBXRUJIT09LYCwgeW91ciBHaXRIdWIgUGVyc29uYWwgQWNjZXNzIFRva2VuIHNob3VsZCBoYXZlXG4gICAqICoqYWRtaW46cmVwb19ob29rKiogc2NvcGUgKGluIGFkZGl0aW9uIHRvIHRoZSByZWd1bGFyICoqcmVwbyoqIHNjb3BlKS5cbiAgICpcbiAgICogQGRlZmF1bHQgR2l0SHViVHJpZ2dlci5XRUJIT09LXG4gICAqL1xuICByZWFkb25seSB0cmlnZ2VyPzogR2l0SHViVHJpZ2dlcjtcblxufVxuXG4vKipcbiAqIEV4dGVuZCBDb2RlUGlwZWxpbmVTb3VyY2Ugc28gd2UgY2FuIHR5cGUtdGVzdCBpbiB0aGUgQ29kZVBpcGVsaW5lRW5naW5lLlxuICovXG5jbGFzcyBHaXRIdWJTb3VyY2UgZXh0ZW5kcyBDb2RlUGlwZWxpbmVTb3VyY2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IG93bmVyOiBzdHJpbmc7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVwbzogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGF1dGhlbnRpY2F0aW9uOiBTZWNyZXRWYWx1ZTtcblxuICBjb25zdHJ1Y3RvcihyZXBvU3RyaW5nOiBzdHJpbmcsIHJlYWRvbmx5IGJyYW5jaDogc3RyaW5nLCByZWFkb25seSBwcm9wczogR2l0SHViU291cmNlT3B0aW9ucykge1xuICAgIHN1cGVyKHJlcG9TdHJpbmcpO1xuXG4gICAgY29uc3QgcGFydHMgPSByZXBvU3RyaW5nLnNwbGl0KCcvJyk7XG4gICAgaWYgKFRva2VuLmlzVW5yZXNvbHZlZChyZXBvU3RyaW5nKSB8fCBwYXJ0cy5sZW5ndGggIT09IDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgR2l0SHViIHJlcG9zaXRvcnkgbmFtZSBzaG91bGQgYmUgYSByZXNvbHZlZCBzdHJpbmcgbGlrZSAnPG93bmVyPi88cmVwbz4nLCBnb3QgJyR7cmVwb1N0cmluZ30nYCk7XG4gICAgfVxuICAgIHRoaXMub3duZXIgPSBwYXJ0c1swXTtcbiAgICB0aGlzLnJlcG8gPSBwYXJ0c1sxXTtcbiAgICB0aGlzLmF1dGhlbnRpY2F0aW9uID0gcHJvcHMuYXV0aGVudGljYXRpb24gPz8gU2VjcmV0VmFsdWUuc2VjcmV0c01hbmFnZXIoJ2dpdGh1Yi10b2tlbicpO1xuICAgIHRoaXMuY29uZmlndXJlUHJpbWFyeU91dHB1dChuZXcgRmlsZVNldCgnU291cmNlJywgdGhpcykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBhY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5HaXRIdWJTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgYWN0aW9uTmFtZSxcbiAgICAgIHJ1bk9yZGVyLFxuICAgICAgb2F1dGhUb2tlbjogdGhpcy5hdXRoZW50aWNhdGlvbixcbiAgICAgIG93bmVyOiB0aGlzLm93bmVyLFxuICAgICAgcmVwbzogdGhpcy5yZXBvLFxuICAgICAgYnJhbmNoOiB0aGlzLmJyYW5jaCxcbiAgICAgIHRyaWdnZXI6IHRoaXMucHJvcHMudHJpZ2dlcixcbiAgICAgIHZhcmlhYmxlc05hbWVzcGFjZSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIE9wdGlvbnMgZm9yIFMzIHNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTM1NvdXJjZU9wdGlvbnMge1xuICAvKipcbiAgICogSG93IHNob3VsZCBDb2RlUGlwZWxpbmUgZGV0ZWN0IHNvdXJjZSBjaGFuZ2VzIGZvciB0aGlzIEFjdGlvbi5cbiAgICogTm90ZSB0aGF0IGlmIHRoaXMgaXMgUzNUcmlnZ2VyLkVWRU5UUywgeW91IG5lZWQgdG8gbWFrZSBzdXJlIHRvIGluY2x1ZGUgdGhlIHNvdXJjZSBCdWNrZXQgaW4gYSBDbG91ZFRyYWlsIFRyYWlsLFxuICAgKiBhcyBvdGhlcndpc2UgdGhlIENsb3VkV2F0Y2ggRXZlbnRzIHdpbGwgbm90IGJlIGVtaXR0ZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IFMzVHJpZ2dlci5QT0xMXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FtYXpvbkNsb3VkV2F0Y2gvbGF0ZXN0L2V2ZW50cy9sb2ctczMtZGF0YS1ldmVudHMuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgdHJpZ2dlcj86IFMzVHJpZ2dlcjtcblxuICAvKipcbiAgICogVGhlIGFjdGlvbiBuYW1lIHVzZWQgZm9yIHRoaXMgc291cmNlIGluIHRoZSBDb2RlUGlwZWxpbmVcbiAgICpcbiAgICogQGRlZmF1bHQgLSBUaGUgYnVja2V0IG5hbWVcbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbk5hbWU/OiBzdHJpbmc7XG59XG5cbmNsYXNzIFMzU291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgYnVja2V0OiBJQnVja2V0LCBwcml2YXRlIHJlYWRvbmx5IG9iamVjdEtleTogc3RyaW5nLCByZWFkb25seSBwcm9wczogUzNTb3VyY2VPcHRpb25zKSB7XG4gICAgc3VwZXIoTm9kZS5vZihidWNrZXQpLmFkZHIpO1xuXG4gICAgdGhpcy5jb25maWd1cmVQcmltYXJ5T3V0cHV0KG5ldyBGaWxlU2V0KCdTb3VyY2UnLCB0aGlzKSk7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0QWN0aW9uKG91dHB1dDogQXJ0aWZhY3QsIF9hY3Rpb25OYW1lOiBzdHJpbmcsIHJ1bk9yZGVyOiBudW1iZXIsIHZhcmlhYmxlc05hbWVzcGFjZT86IHN0cmluZykge1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5TM1NvdXJjZUFjdGlvbih7XG4gICAgICBvdXRwdXQsXG4gICAgICAvLyBCdWNrZXQgbmFtZXMgYXJlIGd1YXJhbnRlZWQgdG8gY29uZm9ybSB0byBBY3Rpb25OYW1lIHJlc3RyaWN0aW9uc1xuICAgICAgYWN0aW9uTmFtZTogdGhpcy5wcm9wcy5hY3Rpb25OYW1lID8/IHRoaXMuYnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICBydW5PcmRlcixcbiAgICAgIGJ1Y2tldEtleTogdGhpcy5vYmplY3RLZXksXG4gICAgICB0cmlnZ2VyOiB0aGlzLnByb3BzLnRyaWdnZXIsXG4gICAgICBidWNrZXQ6IHRoaXMuYnVja2V0LFxuICAgICAgdmFyaWFibGVzTmFtZXNwYWNlLFxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgRUNSIHNvdXJjZXNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFQ1JTb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIFRoZSBpbWFnZSB0YWcgdGhhdCB3aWxsIGJlIGNoZWNrZWQgZm9yIGNoYW5nZXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IGxhdGVzdFxuICAgKi9cbiAgcmVhZG9ubHkgaW1hZ2VUYWc/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBhY3Rpb24gbmFtZSB1c2VkIGZvciB0aGlzIHNvdXJjZSBpbiB0aGUgQ29kZVBpcGVsaW5lXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gVGhlIHJlcG9zaXRvcnkgbmFtZVxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uTmFtZT86IHN0cmluZztcbn1cblxuY2xhc3MgRUNSU291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgY29uc3RydWN0b3IocmVhZG9ubHkgcmVwb3NpdG9yeTogSVJlcG9zaXRvcnksIHJlYWRvbmx5IHByb3BzOiBFQ1JTb3VyY2VPcHRpb25zKSB7XG4gICAgc3VwZXIoTm9kZS5vZihyZXBvc2l0b3J5KS5hZGRyKTtcblxuICAgIHRoaXMuY29uZmlndXJlUHJpbWFyeU91dHB1dChuZXcgRmlsZVNldCgnU291cmNlJywgdGhpcykpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldEFjdGlvbihvdXRwdXQ6IEFydGlmYWN0LCBfYWN0aW9uTmFtZTogc3RyaW5nLCBydW5PcmRlcjogbnVtYmVyLCB2YXJpYWJsZXNOYW1lc3BhY2U6IHN0cmluZykge1xuICAgIC8vIFJlcG9zaXRvcnlOYW1lIGNhbiBjb250YWluICcvJyB0aGF0IGlzIG5vdCBhIHZhbGlkIEFjdGlvbk5hbWUgY2hhcmFjdGVyLCB1c2UgJ18nIGluc3RlYWRcbiAgICBjb25zdCBmb3JtYXR0ZWRSZXBvc2l0b3J5TmFtZSA9IEZuLmpvaW4oJ18nLCBGbi5zcGxpdCgnLycsIHRoaXMucmVwb3NpdG9yeS5yZXBvc2l0b3J5TmFtZSkpO1xuICAgIHJldHVybiBuZXcgY3BfYWN0aW9ucy5FY3JTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgYWN0aW9uTmFtZTogdGhpcy5wcm9wcy5hY3Rpb25OYW1lID8/IGZvcm1hdHRlZFJlcG9zaXRvcnlOYW1lLFxuICAgICAgcnVuT3JkZXIsXG4gICAgICByZXBvc2l0b3J5OiB0aGlzLnJlcG9zaXRvcnksXG4gICAgICBpbWFnZVRhZzogdGhpcy5wcm9wcy5pbWFnZVRhZyxcbiAgICAgIHZhcmlhYmxlc05hbWVzcGFjZSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgQ29kZVN0YXIgc291cmNlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29ubmVjdGlvblNvdXJjZU9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgQ29kZVN0YXIgQ29ubmVjdGlvbiBjcmVhdGVkIGluIHRoZSBBV1MgY29uc29sZVxuICAgKiB0aGF0IGhhcyBwZXJtaXNzaW9ucyB0byBhY2Nlc3MgdGhpcyBHaXRIdWIgb3IgQml0QnVja2V0IHJlcG9zaXRvcnkuXG4gICAqXG4gICAqIEBleGFtcGxlICdhcm46YXdzOmNvZGVzdGFyLWNvbm5lY3Rpb25zOnVzLWVhc3QtMToxMjM0NTY3ODkwMTI6Y29ubmVjdGlvbi8xMjM0NTY3OC1hYmNkLTEyYWItMzRjZGVmNTY3OGdoJ1xuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9jb25uZWN0aW9ucy1jcmVhdGUuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgY29ubmVjdGlvbkFybjogc3RyaW5nO1xuXG5cbiAgLy8gbG9uZyBVUkwgaW4gQHNlZVxuICAvKipcbiAgICogV2hldGhlciB0aGUgb3V0cHV0IHNob3VsZCBiZSB0aGUgY29udGVudHMgb2YgdGhlIHJlcG9zaXRvcnlcbiAgICogKHdoaWNoIGlzIHRoZSBkZWZhdWx0KSxcbiAgICogb3IgYSBsaW5rIHRoYXQgYWxsb3dzIENvZGVCdWlsZCB0byBjbG9uZSB0aGUgcmVwb3NpdG9yeSBiZWZvcmUgYnVpbGRpbmcuXG4gICAqXG4gICAqICoqTm90ZSoqOiBpZiB0aGlzIG9wdGlvbiBpcyB0cnVlLFxuICAgKiB0aGVuIG9ubHkgQ29kZUJ1aWxkIGFjdGlvbnMgY2FuIHVzZSB0aGUgcmVzdWx0aW5nIHtAbGluayBvdXRwdXR9LlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9hY3Rpb24tcmVmZXJlbmNlLUNvZGVzdGFyQ29ubmVjdGlvblNvdXJjZS5odG1sI2FjdGlvbi1yZWZlcmVuY2UtQ29kZXN0YXJDb25uZWN0aW9uU291cmNlLWNvbmZpZ1xuICAgKi9cbiAgcmVhZG9ubHkgY29kZUJ1aWxkQ2xvbmVPdXRwdXQ/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBDb250cm9scyBhdXRvbWF0aWNhbGx5IHN0YXJ0aW5nIHlvdXIgcGlwZWxpbmUgd2hlbiBhIG5ldyBjb21taXRcbiAgICogaXMgbWFkZSBvbiB0aGUgY29uZmlndXJlZCByZXBvc2l0b3J5IGFuZCBicmFuY2guIElmIHVuc3BlY2lmaWVkLFxuICAgKiB0aGUgZGVmYXVsdCB2YWx1ZSBpcyB0cnVlLCBhbmQgdGhlIGZpZWxkIGRvZXMgbm90IGRpc3BsYXkgYnkgZGVmYXVsdC5cbiAgICpcbiAgICogQGRlZmF1bHQgdHJ1ZVxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9hY3Rpb24tcmVmZXJlbmNlLUNvZGVzdGFyQ29ubmVjdGlvblNvdXJjZS5odG1sXG4gICAqL1xuICByZWFkb25seSB0cmlnZ2VyT25QdXNoPzogYm9vbGVhbjtcbn1cblxuY2xhc3MgQ29kZVN0YXJDb25uZWN0aW9uU291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgcHJpdmF0ZSByZWFkb25seSBvd25lcjogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IHJlcG86IHN0cmluZztcblxuICBjb25zdHJ1Y3RvcihyZXBvU3RyaW5nOiBzdHJpbmcsIHJlYWRvbmx5IGJyYW5jaDogc3RyaW5nLCByZWFkb25seSBwcm9wczogQ29ubmVjdGlvblNvdXJjZU9wdGlvbnMpIHtcbiAgICBzdXBlcihyZXBvU3RyaW5nKTtcblxuICAgIGNvbnN0IHBhcnRzID0gcmVwb1N0cmluZy5zcGxpdCgnLycpO1xuICAgIGlmIChUb2tlbi5pc1VucmVzb2x2ZWQocmVwb1N0cmluZykgfHwgcGFydHMubGVuZ3RoICE9PSAyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENvZGVTdGFyIHJlcG9zaXRvcnkgbmFtZSBzaG91bGQgYmUgYSByZXNvbHZlZCBzdHJpbmcgbGlrZSAnPG93bmVyPi88cmVwbz4nLCBnb3QgJyR7cmVwb1N0cmluZ30nYCk7XG4gICAgfVxuICAgIHRoaXMub3duZXIgPSBwYXJ0c1swXTtcbiAgICB0aGlzLnJlcG8gPSBwYXJ0c1sxXTtcbiAgICB0aGlzLmNvbmZpZ3VyZVByaW1hcnlPdXRwdXQobmV3IEZpbGVTZXQoJ1NvdXJjZScsIHRoaXMpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBY3Rpb24ob3V0cHV0OiBBcnRpZmFjdCwgYWN0aW9uTmFtZTogc3RyaW5nLCBydW5PcmRlcjogbnVtYmVyLCB2YXJpYWJsZXNOYW1lc3BhY2U/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IGNwX2FjdGlvbnMuQ29kZVN0YXJDb25uZWN0aW9uc1NvdXJjZUFjdGlvbih7XG4gICAgICBvdXRwdXQsXG4gICAgICBhY3Rpb25OYW1lLFxuICAgICAgcnVuT3JkZXIsXG4gICAgICBjb25uZWN0aW9uQXJuOiB0aGlzLnByb3BzLmNvbm5lY3Rpb25Bcm4sXG4gICAgICBvd25lcjogdGhpcy5vd25lcixcbiAgICAgIHJlcG86IHRoaXMucmVwbyxcbiAgICAgIGJyYW5jaDogdGhpcy5icmFuY2gsXG4gICAgICBjb2RlQnVpbGRDbG9uZU91dHB1dDogdGhpcy5wcm9wcy5jb2RlQnVpbGRDbG9uZU91dHB1dCxcbiAgICAgIHRyaWdnZXJPblB1c2g6IHRoaXMucHJvcHMudHJpZ2dlck9uUHVzaCxcbiAgICAgIHZhcmlhYmxlc05hbWVzcGFjZSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gb3B0aW9ucyBmb3IgYSBDb2RlQ29tbWl0IHNvdXJjZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvZGVDb21taXRTb3VyY2VPcHRpb25zIHtcbiAgLyoqXG4gICAqIEhvdyBzaG91bGQgQ29kZVBpcGVsaW5lIGRldGVjdCBzb3VyY2UgY2hhbmdlcyBmb3IgdGhpcyBBY3Rpb24uXG4gICAqXG4gICAqIEBkZWZhdWx0IENvZGVDb21taXRUcmlnZ2VyLkVWRU5UU1xuICAgKi9cbiAgcmVhZG9ubHkgdHJpZ2dlcj86IENvZGVDb21taXRUcmlnZ2VyO1xuXG4gIC8qKlxuICAgKiBSb2xlIHRvIGJlIHVzZWQgYnkgb24gY29tbWl0IGV2ZW50IHJ1bGUuXG4gICAqIFVzZWQgb25seSB3aGVuIHRyaWdnZXIgdmFsdWUgaXMgQ29kZUNvbW1pdFRyaWdnZXIuRVZFTlRTLlxuICAgKlxuICAgKiBAZGVmYXVsdCBhIG5ldyByb2xlIHdpbGwgYmUgY3JlYXRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGV2ZW50Um9sZT86IGlhbS5JUm9sZTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgb3V0cHV0IHNob3VsZCBiZSB0aGUgY29udGVudHMgb2YgdGhlIHJlcG9zaXRvcnlcbiAgICogKHdoaWNoIGlzIHRoZSBkZWZhdWx0KSxcbiAgICogb3IgYSBsaW5rIHRoYXQgYWxsb3dzIENvZGVCdWlsZCB0byBjbG9uZSB0aGUgcmVwb3NpdG9yeSBiZWZvcmUgYnVpbGRpbmcuXG4gICAqXG4gICAqICoqTm90ZSoqOiBpZiB0aGlzIG9wdGlvbiBpcyB0cnVlLFxuICAgKiB0aGVuIG9ubHkgQ29kZUJ1aWxkIGFjdGlvbnMgY2FuIHVzZSB0aGUgcmVzdWx0aW5nIHtAbGluayBvdXRwdXR9LlxuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9jb2RlcGlwZWxpbmUvbGF0ZXN0L3VzZXJndWlkZS9hY3Rpb24tcmVmZXJlbmNlLUNvZGVDb21taXQuaHRtbFxuICAgKi9cbiAgcmVhZG9ubHkgY29kZUJ1aWxkQ2xvbmVPdXRwdXQ/OiBib29sZWFuO1xufVxuXG5jbGFzcyBDb2RlQ29tbWl0U291cmNlIGV4dGVuZHMgQ29kZVBpcGVsaW5lU291cmNlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSByZXBvc2l0b3J5OiBjb2RlY29tbWl0LklSZXBvc2l0b3J5LCBwcml2YXRlIHJlYWRvbmx5IGJyYW5jaDogc3RyaW5nLCBwcml2YXRlIHJlYWRvbmx5IHByb3BzOiBDb2RlQ29tbWl0U291cmNlT3B0aW9ucykge1xuICAgIHN1cGVyKFRva2VuLmlzVW5yZXNvbHZlZChyZXBvc2l0b3J5LnJlcG9zaXRvcnlOYW1lKVxuICAgICAgPyBOb2RlLm9mKHJlcG9zaXRvcnkpLmFkZHJcbiAgICAgIDogcmVwb3NpdG9yeS5yZXBvc2l0b3J5TmFtZSk7XG5cbiAgICB0aGlzLmNvbmZpZ3VyZVByaW1hcnlPdXRwdXQobmV3IEZpbGVTZXQoJ1NvdXJjZScsIHRoaXMpKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRBY3Rpb24ob3V0cHV0OiBBcnRpZmFjdCwgX2FjdGlvbk5hbWU6IHN0cmluZywgcnVuT3JkZXI6IG51bWJlciwgdmFyaWFibGVzTmFtZXNwYWNlPzogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBjcF9hY3Rpb25zLkNvZGVDb21taXRTb3VyY2VBY3Rpb24oe1xuICAgICAgb3V0cHV0LFxuICAgICAgLy8gR3VhcmFudGVlZCB0byBiZSBva2F5IGFzIGFjdGlvbiBuYW1lXG4gICAgICBhY3Rpb25OYW1lOiB0aGlzLnJlcG9zaXRvcnkucmVwb3NpdG9yeU5hbWUsXG4gICAgICBydW5PcmRlcixcbiAgICAgIGJyYW5jaDogdGhpcy5icmFuY2gsXG4gICAgICB0cmlnZ2VyOiB0aGlzLnByb3BzLnRyaWdnZXIsXG4gICAgICByZXBvc2l0b3J5OiB0aGlzLnJlcG9zaXRvcnksXG4gICAgICBldmVudFJvbGU6IHRoaXMucHJvcHMuZXZlbnRSb2xlLFxuICAgICAgY29kZUJ1aWxkQ2xvbmVPdXRwdXQ6IHRoaXMucHJvcHMuY29kZUJ1aWxkQ2xvbmVPdXRwdXQsXG4gICAgICB2YXJpYWJsZXNOYW1lc3BhY2UsXG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==